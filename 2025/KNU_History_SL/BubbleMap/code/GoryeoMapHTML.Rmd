---
title: "R을 사용하여 지도 시각화 생성하기(i.e., leaflet)"
author: "문성민(Seongmin Mun)"
date: "2025-08-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


R을 통해 역사적 인물들의 지역 관계를 분석하는 시각화를 생성하는 것을 목적으로 진행하게된 이번 강연에서는 R에서 제공하는 leaflet패키지(<https://rstudio.github.io/leaflet/>)를 사용한다. 강연은 지도 시각화에서 각 요소의 특징을 바꾸는 것으로 시작하여 실제 역사 데이터를 활용하여 지도 시각화를 생성하는 전반적인 과정을 다루고자 한다.

## 1.패키지 설치하기

```{r}
# install.packages("leaflet")
library(leaflet)
# install.packages("dplyr")
library(dplyr)
```

지도 시각화를 생성하기 위해 우선 leaflet와 dplyr(파이프 사용)패키지를 설치하고 불러온다.


## 2.기본적인 지도 생성하기

```{r}
# 기본 지도 바탕 생성
map <- leaflet(); map
```

```{r}
# 지도 바탕 위에 타일 생성
map <- leaflet() %>% addTiles(); map
```

파이브 연산자를 통해 지도 생성을 위한 하위 함수들을 지도 생성 함수와 연계하여 기본적인 지도를 생성하였다.

## 3.서로 상이한 모습의 타일 생성하기

```{r}
str(providers)
```

```{r}
#기본형
map <- leaflet() %>% addProviderTiles(providers$Esri); map
```

```{r}
#더 진한 모드
map <- leaflet() %>% addProviderTiles(providers$Esri.WorldImagery); map
```

```{r}
#다크
map <- leaflet() %>% addProviderTiles(providers$CartoDB.DarkMatter); map
```

```{r}
#회색
map <- leaflet() %>% addProviderTiles(providers$CartoDB.Positron); map
```

## 4.좌표와 연동하기

```{r}
# 초기 위치(관점)지정하기 #경북대 인문한국진흥관
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15); map
```

구글맵(<https://www.google.com/maps>)를 사용하여 원하는 위칭의 좌표를 가져와 시각화에 연동한다.

### 4.1.마커 생성하기
```{r}
# 초기 위치(관점)지정하기 #경북대 인문한국진흥관
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15) %>% addMarkers(lng=128.6108, lat=35.8902); map
```

### 4.2.팝업 추가하기
```{r}
# 초기 위치(관점)지정하기 #경북대 인문한국진흥관
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15) %>% addMarkers(lng=128.6108, lat=35.8902, popup="경북대학교"); map
```

### 4.3.여러 다른 모양의 마커 생성하기
```{r}
# 깃발
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15) %>% addAwesomeMarkers(lng=128.6108, lat=35.8902, icon= awesomeIcons(icon = 'flag', markerColor = 'orange', iconColor = 'white')); map
```

```{r}
# 집
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15) %>% addAwesomeMarkers(lng=128.6108, lat=35.8902, icon= awesomeIcons(icon = 'home', markerColor = 'blue', iconColor = 'white')); map
```

```{r}
## 원형 마커 생성하기
map <- leaflet() %>% addTiles() %>% setView(lng=128.6108, lat=35.8902, zoom = 15) %>% addCircleMarkers(lng=128.6108, lat=35.8902, radius = 20); map
```


## 5.데이터와 연동하여 사용하기

### 5.1. 경로 지정하기

```{r}
# getwd()
# setwd("/Users/seongminmun/Desktop/Development/Rprogram/R_Script/data/")
# dir()
```

```{r}
#한국어를 사용하는 경유 인코딩 변경
Sys.setlocale(category = "LC_CTYPE", locale = "ko_KR.UTF-8")
#window사용
#options(encoding = 'UTF-8')
```

현재 R과 연결된 자신의 작업 환경 경로를 확인하고 데이터가 있는 경로로 지정한다.

### 5.2. 데이터 (인구수 데이터) 불러오기

```{r}
dataSK <- read.table("SK_pop.txt", header = T)
summary(dataSK)
```

### 5.3. 데이터 (인구수 데이터) 시각화하기

```{r}
#인구수를 데이터 사이즈로 사용
map <- leaflet(dataSK) %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3) ; map
```

```{r}
#데이터 변형
# 집단 정보 추가하기
dataSKClass <- dataSK %>% mutate(class = ifelse(총인구수>mean(총인구수),"1","0"))
head(dataSKClass)
```


```{r}
#색상 수동으로 생성하기
pal <- colorFactor(c("#ffa500", "#13ED3F"), domain=c("1", "0"))
map <- leaflet(dataSKClass) %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class)) ; map
```

```{r}
#색상에 따른 범례 수동으로 생성하기
map <- leaflet(dataSKClass) %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class)) %>% addLegend("bottomright", colors= c("#ffa500", "#13ED3F"), labels=c("1", "0"), title="도시 밀집도"); map
```

### 5.4. 여러 시각화 기능 사용하기

```{r}
# 기타 추가
# 미니맵 생성하기
map <- leaflet(dataSKClass) %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class)) %>% addLegend("bottomleft", colors= c("#ffa500", "#13ED3F"), labels=c("1", "0"), title="도시 밀집도") %>% addMiniMap(width = 150, height = 150); map
```

```{r}
# 데이터들 순서대로 선 생성하기 -> 경로 지도위에 표시
map <- leaflet(dataSKClass) %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class)) %>% addLegend("bottomleft", colors= c("#ffa500", "#13ED3F"), labels=c("1", "0"), title="도시 밀집도") %>% addMiniMap(width = 150, height = 150) %>% addPolylines(lng=~LON, lat=~LAT, weight=.5); map
```


```{r}
#옵션 버튼 사용하기
group1 <- subset(dataSKClass, class==1)
group2 <- subset(dataSKClass, class==0)
map <- leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% setView(lng=127.0462, lat=37.2819, zoom = 7) %>% addCircles(data = group1, lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class), group = "group1")  %>% addCircles(data = group2, lng=~LON, lat=~LAT, radius=~sqrt(총인구수)*3, color=~pal(class), group = "group2") %>% addLayersControl(overlay = c("group1","group2"), options = layersControlOptions(collapsed = FALSE)); map
```





## 6. 역사 데이터 (i.e., 고려 초기, 태조 왕건의 지역 데이터)

### 6.1. 데이터 (i.e., 고려 초기, 태조 왕건의 지역 데이터) 불러오기

```{r}
mapData<- read.csv("map_teajo_re.csv", header=TRUE, fileEncoding="UTF-8"); head(mapData)
```

### 6.2. 변수 구분하기

```{r}
city <- mapData$city
lat <- mapData$lat
lon <- mapData$long
freq <- mapData$freq

travelPlan <- data.frame(city = city, lat = lat, lon = lon, freq = freq)
head(travelPlan)
```

### 6.3. 데이터 시각화 하기

```{r}
map <- leaflet(travelPlan) %>% addProviderTiles(providers$CartoDB.DarkMatter) %>% setView(lng=127.0462, lat=37.2819, zoom = 5) %>% addCircles(lng=~lon, lat=~lat, radius=~freq*3000, color = "yellow") %>% addMiniMap(width = 150, height = 150); map
```

실제 가공된 역사 데이터(`data.frame`)에서 고려 초기 태조 왕건이 어떤 지방과 관계를 강하게 형성하였는지 확인할 수 있다.


